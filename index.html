<!DOCTYPE html>
<html lang="hy">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HayVoc ‚Äî –°–ª–æ–≤–∞—Ä—å</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
<style>
body { font-family: 'Ubuntu', sans-serif; background: #fefefe; margin: 20px; }
h1 { font-size: 2em; text-align: center; }
.letter { font-weight: bold; margin-top: 20px; font-size: 1.3em; }
.word-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #ddd; }
.word-text { flex: 1; }
.controls button { margin-left: 5px; }
input { padding: 5px; margin: 5px 0; width: calc(100% - 12px); }
#login-btn { margin-bottom: 10px; }
#status { position: fixed; bottom: 10px; right: 10px; font-size: 12px; color: gray; }
</style>
</head>
<body>
<h1>HayVoc ‚Äî –°–ª–æ–≤–∞—Ä—å</h1>

<button id="login-btn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>

<input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ —Å–ª–æ–≤...">

<div>
<input type="text" id="new-word-hy" placeholder="–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ (–∞—Ä–º.)">
<input type="text" id="new-word-ru" placeholder="–ü–µ—Ä–µ–≤–æ–¥ (—Ä—É—Å.)">
<button id="add-word">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</button>
</div>

<div id="dictionary"></div>
<div id="status">üü° –û—Ñ—Ñ–ª–∞–π–Ω</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
apiKey: "AIzaSyBkV7vEW7nJVA1cgnOqMvy_d_o93SHFhi8",
authDomain: "hayvoc-be65a.firebaseapp.com",
projectId: "hayvoc-be65a",
storageBucket: "hayvoc-be65a.firebasestorage.app",
messagingSenderId: "869545719945",
appId: "1:869545719945:web:fa1ea0b01fa0f86ec62e58",
measurementId: "G-17536XH7VE"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// –í–∫–ª—é—á–∞–µ–º –æ—Ñ–ª–∞–π–Ω-–ø–æ–¥–¥–µ—Ä–∂–∫—É Firestore
db.enablePersistence()
.then(() => console.log('üì¶ Offline persistence enabled'))
.catch(err => {
if (err.code === 'failed-precondition') {
console.log('‚ö†Ô∏è Persistence —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ');
} else if (err.code === 'unimplemented') {
console.log('‚ö†Ô∏è –≠—Ç–æ—Ç –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç persistence');
}
});

let currentUser = null;
const dictionaryDiv = document.getElementById('dictionary');
const searchInput = document.getElementById('search');
const newWordHy = document.getElementById('new-word-hy');
const newWordRu = document.getElementById('new-word-ru');
const statusEl = document.getElementById('status');

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ç–∏
function updateStatus() {
if (navigator.onLine) {
statusEl.textContent = 'üü¢ –û–Ω–ª–∞–π–Ω';
} else {
statusEl.textContent = 'üü° –û—Ñ—Ñ–ª–∞–π–Ω';
}
}
window.addEventListener('online', updateStatus);
window.addEventListener('offline', updateStatus);
updateStatus();

// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google
document.getElementById('login-btn').addEventListener('click', () => {
const provider = new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(provider);
});

auth.onAuthStateChanged(user => {
if (user) {
currentUser = user;
document.getElementById('login-btn').style.display = 'none';
loadDictionary();
} else {
currentUser = null;
document.getElementById('login-btn').style.display = 'block';
dictionaryDiv.innerHTML = '';
}
});

// –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ
document.getElementById('add-word').addEventListener('click', () => {
if (!currentUser) return alert("–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google");
const hy = newWordHy.value.trim();
const ru = newWordRu.value.trim();
if (!hy || !ru) return;
db.collection('users').doc(currentUser.uid).collection('words').add({ hy, ru })
.then(() => {
newWordHy.value = '';
newWordRu.value = '';
});
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä—è (—Å realtime listener)
function loadDictionary() {
db.collection('users').doc(currentUser.uid).collection('words')
.orderBy('hy')
.onSnapshot(snapshot => {
const words = [];
snapshot.forEach(doc => {
words.push({ id: doc.id, ...doc.data() });
});
renderDictionary(words);
});
}

function renderDictionary(words) {
const query = searchInput.value.trim().toLowerCase();
const filtered = words.filter(w => w.hy.toLowerCase().includes(query) || w.ru.toLowerCase().includes(query));

const grouped = {};
filtered.forEach(w => {
const letter = w.hy[0]?.toUpperCase() || '?';
if (!grouped[letter]) grouped[letter] = [];
grouped[letter].push(w);
});

dictionaryDiv.innerHTML = '';
Object.keys(grouped).sort().forEach(letter => {
const letterDiv = document.createElement('div');
letterDiv.className = 'letter';
letterDiv.textContent = letter;
dictionaryDiv.appendChild(letterDiv);

grouped[letter].forEach(word => {
const div = document.createElement('div');
div.className = 'word-item';
const span = document.createElement('span');
span.className = 'word-text';
span.textContent = `${word.hy} ‚Äî ${word.ru}`;

const controls = document.createElement('span');
controls.className = 'controls';

const editBtn = document.createElement('button');
editBtn.textContent = '‚úè';
editBtn.onclick = () => editWord(word);

const delBtn = document.createElement('button');
delBtn.textContent = 'üóë';
delBtn.onclick = () => deleteWord(word);

controls.appendChild(editBtn);
controls.appendChild(delBtn);

div.appendChild(span);
div.appendChild(controls);
dictionaryDiv.appendChild(div);
});
});
}

function editWord(word) {
const newHy = prompt('–ù–æ–≤–æ–µ –∞—Ä–º—è–Ω—Å–∫–æ–µ —Å–ª–æ–≤–æ:', word.hy);
const newRu = prompt('–ù–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥:', word.ru);
if (!newHy || !newRu) return;
db.collection('users').doc(currentUser.uid).collection('words').doc(word.id).update({ hy: newHy, ru: newRu });
}

function deleteWord(word) {
if (confirm('–£–¥–∞–ª–∏—Ç—å —Å–ª–æ–≤–æ?')) {
db.collection('users').doc(currentUser.uid).collection('words').doc(word.id).delete();
}
}

searchInput.addEventListener('input', () => {
loadDictionary();
});
</script>

<!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è service worker -->
<script>
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('service-worker.js')
.then(() => console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
.catch(err => console.log('–û—à–∏–±–∫–∞ SW:', err));
}
</script>
</body>
</html>
